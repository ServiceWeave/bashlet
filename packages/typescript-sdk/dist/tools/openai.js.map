{"version":3,"sources":["../../src/schemas/json-schema.ts","../../src/tools/openai.ts"],"names":[],"mappings":"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","file":"openai.js","sourcesContent":["/**\n * JSON Schema type definition (simplified for our needs)\n */\nexport interface JSONSchema {\n  type: string;\n  description?: string;\n  properties?: Record<string, JSONSchema>;\n  required?: string[];\n  additionalProperties?: boolean;\n  items?: JSONSchema;\n  enum?: string[];\n}\n\n/**\n * JSON Schema for bashlet_exec tool input\n */\nexport const execJsonSchema: JSONSchema = {\n  type: \"object\",\n  properties: {\n    command: {\n      type: \"string\",\n      description: \"The shell command to execute in the sandbox\",\n    },\n    workdir: {\n      type: \"string\",\n      description: \"Working directory inside the sandbox (default: /workspace)\",\n    },\n  },\n  required: [\"command\"],\n  additionalProperties: false,\n};\n\n/**\n * JSON Schema for bashlet_read_file tool input\n */\nexport const readFileJsonSchema: JSONSchema = {\n  type: \"object\",\n  properties: {\n    path: {\n      type: \"string\",\n      description: \"Absolute path to the file inside the sandbox\",\n    },\n  },\n  required: [\"path\"],\n  additionalProperties: false,\n};\n\n/**\n * JSON Schema for bashlet_write_file tool input\n */\nexport const writeFileJsonSchema: JSONSchema = {\n  type: \"object\",\n  properties: {\n    path: {\n      type: \"string\",\n      description: \"Absolute path to the file inside the sandbox\",\n    },\n    content: {\n      type: \"string\",\n      description: \"Content to write to the file\",\n    },\n  },\n  required: [\"path\", \"content\"],\n  additionalProperties: false,\n};\n\n/**\n * JSON Schema for bashlet_list_dir tool input\n */\nexport const listDirJsonSchema: JSONSchema = {\n  type: \"object\",\n  properties: {\n    path: {\n      type: \"string\",\n      description: \"Absolute path to the directory inside the sandbox\",\n    },\n  },\n  required: [\"path\"],\n  additionalProperties: false,\n};\n","import type { Bashlet } from \"../client.js\";\nimport {\n  execJsonSchema,\n  readFileJsonSchema,\n  writeFileJsonSchema,\n  listDirJsonSchema,\n  type JSONSchema,\n} from \"../schemas/json-schema.js\";\n\n/**\n * OpenAI function calling tool structure\n */\nexport interface OpenAITool {\n  type: \"function\";\n  function: {\n    name: string;\n    description: string;\n    parameters: JSONSchema;\n  };\n}\n\n/**\n * OpenAI tool with handler for executing tool calls\n */\nexport interface OpenAIToolWithHandler extends OpenAITool {\n  handler: (args: Record<string, unknown>) => Promise<string>;\n}\n\n/**\n * Generate OpenAI function calling-compatible tools with handlers.\n *\n * @param client - Bashlet client instance\n * @returns Array of OpenAI tools with handlers\n *\n * @example\n * ```typescript\n * import OpenAI from 'openai';\n * import { Bashlet, generateOpenAITools } from '@bashlet/sdk';\n *\n * const openai = new OpenAI();\n * const bashlet = new Bashlet();\n * const tools = generateOpenAITools(bashlet);\n *\n * const response = await openai.chat.completions.create({\n *   model: 'gpt-4-turbo',\n *   tools: tools.map(t => ({ type: t.type, function: t.function })),\n *   messages: [{ role: 'user', content: 'List files in the current directory' }],\n * });\n *\n * // Handle tool calls\n * for (const toolCall of response.choices[0].message.tool_calls ?? []) {\n *   const tool = tools.find(t => t.function.name === toolCall.function.name);\n *   const result = await tool.handler(JSON.parse(toolCall.function.arguments));\n *   console.log(result);\n * }\n * ```\n */\nexport function generateOpenAITools(client: Bashlet): OpenAIToolWithHandler[] {\n  return [\n    {\n      type: \"function\",\n      function: {\n        name: \"bashlet_exec\",\n        description:\n          \"Execute a shell command in a sandboxed bash environment. \" +\n          \"Returns stdout, stderr, and exit code. \" +\n          \"Use this for running shell commands, scripts, and system operations safely.\",\n        parameters: execJsonSchema,\n      },\n      handler: async (args) => {\n        const { command, workdir } = args as { command: string; workdir?: string };\n        const result = await client.exec(command, { workdir });\n        return JSON.stringify({\n          stdout: result.stdout,\n          stderr: result.stderr,\n          exitCode: result.exitCode,\n        });\n      },\n    },\n    {\n      type: \"function\",\n      function: {\n        name: \"bashlet_read_file\",\n        description:\n          \"Read the contents of a file from the sandboxed environment. \" +\n          \"Returns the file content as a string.\",\n        parameters: readFileJsonSchema,\n      },\n      handler: async (args) => {\n        const { path } = args as { path: string };\n        return await client.readFile(path);\n      },\n    },\n    {\n      type: \"function\",\n      function: {\n        name: \"bashlet_write_file\",\n        description:\n          \"Write content to a file in the sandboxed environment. \" +\n          \"Creates the file if it doesn't exist, overwrites if it does.\",\n        parameters: writeFileJsonSchema,\n      },\n      handler: async (args) => {\n        const { path, content } = args as { path: string; content: string };\n        await client.writeFile(path, content);\n        return JSON.stringify({ success: true, path });\n      },\n    },\n    {\n      type: \"function\",\n      function: {\n        name: \"bashlet_list_dir\",\n        description:\n          \"List the contents of a directory in the sandboxed environment. \" +\n          \"Returns a detailed listing with file permissions, sizes, and names.\",\n        parameters: listDirJsonSchema,\n      },\n      handler: async (args) => {\n        const { path } = args as { path: string };\n        return await client.listDir(path);\n      },\n    },\n  ];\n}\n\n/**\n * Get just the tool definitions (for passing to OpenAI API).\n *\n * @param client - Bashlet client instance\n * @returns Array of OpenAI tool definitions (without handlers)\n *\n * @example\n * ```typescript\n * const tools = getOpenAIToolDefinitions(bashlet);\n * const response = await openai.chat.completions.create({\n *   model: 'gpt-4-turbo',\n *   tools,\n *   messages: [...],\n * });\n * ```\n */\nexport function getOpenAIToolDefinitions(client: Bashlet): OpenAITool[] {\n  return generateOpenAITools(client).map(({ type, function: fn }) => ({\n    type,\n    function: fn,\n  }));\n}\n\n/**\n * Create a tool handler map for processing tool calls.\n *\n * @param client - Bashlet client instance\n * @returns Function that handles tool calls by name\n *\n * @example\n * ```typescript\n * const handleToolCall = createOpenAIToolHandler(bashlet);\n *\n * // After getting tool calls from OpenAI response\n * for (const toolCall of response.choices[0].message.tool_calls) {\n *   const result = await handleToolCall(\n *     toolCall.function.name,\n *     JSON.parse(toolCall.function.arguments)\n *   );\n *   // Send result back to OpenAI\n * }\n * ```\n */\nexport function createOpenAIToolHandler(client: Bashlet) {\n  const tools = generateOpenAITools(client);\n  const handlerMap = new Map(tools.map((t) => [t.function.name, t.handler]));\n\n  return async (name: string, args: Record<string, unknown>): Promise<string> => {\n    const handler = handlerMap.get(name);\n    if (!handler) {\n      throw new Error(`Unknown tool: ${name}`);\n    }\n    return handler(args);\n  };\n}\n"]}